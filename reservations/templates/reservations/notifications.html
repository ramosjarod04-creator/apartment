{% extends 'base.html' %}

{% block title %}Notifications - Apartment Reservation{% endblock %}

{% block content %}
<div class="container notif-container">
    <div class="page-header">
        <div class="header-text">
            <h1>Notifications</h1>
            {% if unread_notifications_count > 0 %}
                <span class="count-badge">{{ unread_notifications_count }} Unread</span>
            {% endif %}
        </div>
        {% if notifications %}
        <div class="header-actions">
            <a href="?mark_read=true" class="btn btn-outline btn-sm">Mark All as Read</a>
            <form method="POST" action="{% url 'notification_clear_all' %}" onsubmit="return confirm('Delete all notifications?');">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-sm">Clear All</button>
            </form>
        </div>
        {% endif %}
    </div>

    <div class="notifications-wrapper">
        {% if notifications %}
            <div class="notifications-list">
                {% for notification in notifications %}
                <div class="notification-item {% if not notification.is_read %}unread{% endif %}">
                    <div class="notif-body">
                        <p class="notif-message">{{ notification.message }}</p>
                        <span class="notif-date">{{ notification.created_at|timesince }} ago</span>
                    </div>
                    
                    <div class="notif-actions">
                        {% if not notification.is_read %}
                        <a href="{% url 'notification_read' notification.pk %}" class="action-link">Mark Read</a>
                        {% endif %}
                        <form method="POST" action="{% url 'notification_delete' notification.pk %}" onsubmit="return confirm('Delete?');">
                            {% csrf_token %}
                            <button type="submit" class="delete-icon-btn" title="Delete notification">Ã—</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="empty-state">
                <div class="empty-visual">All Caught Up</div>
                <h3>No notifications</h3>
                <p>We'll notify you here when there's an update on your account or reservations.</p>
                <a href="{% url 'dashboard' %}" class="btn btn-primary">Return to Dashboard</a>
            </div>
        {% endif %}
    </div>
</div>

<style>
    .notif-container { max-width: 800px; margin: 2rem auto; }

    /* Header */
    .page-header { 
        display: flex; justify-content: space-between; align-items: flex-end; 
        margin-bottom: 1.5rem; border-bottom: 1px solid var(--gray-100); padding-bottom: 1rem;
    }
    .header-text { display: flex; align-items: center; gap: 12px; }
    .count-badge { 
        background: var(--warning); color: #92400e; font-size: 0.75rem; 
        font-weight: 800; padding: 2px 10px; border-radius: 12px; text-transform: uppercase;
    }
    .header-actions { display: flex; gap: 10px; }

    /* Wrapper */
    .notifications-wrapper {
        background: white;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-md);
        overflow: hidden;
        border: 1px solid var(--gray-200);
    }

    /* Items */
    .notification-item {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 1.5rem;
        padding: 1.25rem 1.5rem;
        border-bottom: 1px solid var(--gray-100);
        transition: background 0.2s;
        align-items: center;
    }
    .notification-item:last-child { border-bottom: none; }
    
    .notification-item.unread {
        background: #f0f7ff;
        border-left: 4px solid var(--primary);
    }

    .notif-message { margin: 0 0 4px 0; color: var(--dark); font-weight: 500; line-height: 1.4; }
    .notif-date { font-size: 0.8rem; color: var(--gray-400); }

    /* Actions */
    .notif-actions { display: flex; align-items: center; gap: 15px; }
    .action-link { font-size: 0.8rem; font-weight: 700; color: var(--primary); text-decoration: none; }
    .action-link:hover { text-decoration: underline; }

    .delete-icon-btn {
        background: none; border: none; color: var(--gray-300); 
        font-size: 1.5rem; cursor: pointer; line-height: 1; padding: 0 5px;
        transition: color 0.2s;
    }
    .delete-icon-btn:hover { color: #ef4444; }

    /* Empty State */
    .empty-state { text-align: center; padding: 5rem 2rem; }
    .empty-visual { 
        font-weight: 800; font-size: 0.9rem; color: var(--gray-300); 
        text-transform: uppercase; letter-spacing: 2px; margin-bottom: 1rem;
    }

    /* Buttons override for consistency */
    .btn-danger { background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; }
    .btn-danger:hover { background: #fecaca; }

    /* Mobile */
    @media (max-width: 600px) {
        .page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
        .notification-item { grid-template-columns: 1fr; gap: 0.75rem; }
        .notif-actions { border-top: 1px solid var(--gray-50); padding-top: 0.75rem; justify-content: space-between; }
    }
</style>
